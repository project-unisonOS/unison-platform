[Unit]
Description=Unison Authentication Service
Documentation=https://docs.unison.ai
After=network.target redis.service
Wants=redis.service

[Service]
Type=simple
User=unison
Group=unison
WorkingDirectory=/opt/unison/unison-auth

# Environment
EnvironmentFile=/opt/unison/.env
Environment="PYTHONPATH=/opt/unison/unison-auth/src"
Environment="UNISON_AUTH_PORT=8088"
Environment="UNISON_AUTH_HOST=0.0.0.0"
Environment="UNISON_AUTH_KEYS_DIR=/var/lib/unison/keys"

# Start command
ExecStart=/usr/bin/python3.12 /opt/unison/unison-auth/src/auth_service.py

# Restart policy
Restart=on-failure
RestartSec=5s
StartLimitInterval=60s
StartLimitBurst=3

# Resource limits
LimitNOFILE=65536
MemoryMax=1G
CPUQuota=100%

# Security
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/unison /var/log/unison

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=unison-auth

[Install]
WantedBy=multi-user.target
